<!DOCTYPE html>
<html lang="en">
  <head>
    <title><$bash gP -f config.gomn dashboard name $></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      @charset "UTF-8";
      /* set font from config (uses a Bash little logic) */
      <$bash printf "\n"
        title_font="$(gP -f config.gomn dashboard custom\ css fonts title)"
        title_font_name=""
        if [[ "${title_font}" -ne "" ]]; then #" (stops treesitter bug)
          printf "@font-face {\n"
          printf "  font-family: \"title\";\n"
          printf "  src: url('${title_font}');\n"
          printf "}\n"
          primary_font_name="title"
        else
          printf "@import url('https://fonts.googleapis.com/css2?family=Changa+One:ital@0;1&display=swap');\n"
          title_font_name="Changa One"
        fi
        primary_font="$(gP -f config.gomn dashboard custom\ css fonts primary)"
        primary_font_name=""
        if [[ "${primary_font}" -ne "" ]]; then #" (stops treesitter bug)
          printf "@font-face {\n"
          printf "  font-family: \"primary\";\n"
          printf "  src: url('${primary_font}');"
          printf "\n}\n"
          primary_font_name="primary"
        else
          printf "@import url('https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap');\n"
          primary_font_name="Josefin Sans"
        fi
        printf ":root {\n"
        printf "  --title-font: \"${title_font_name}\";\n"
        printf "  --primary-font: \"${primary_font_name}\";\n"
        printf "}\n"
      $>
      /* sets color variables based on config values */
      :root {
        --primary: <$bash gP -f config.gomn dashboard custom\ css colors primary $>;
        --secondary: <$bash gP -f config.gomn dashboard custom\ css colors secondary $>;
        --tertiary: <$bash gP -f config.gomn dashboard custom\ css colors tertiary $>;
        --bg: <$bash gP -f config.gomn dashboard custom\ css colors background $>;
        --sTcolor: <$bash gP -f config.gomn dashboard custom\ css colors secondary\ text\ color $>;
        --pTcolor: <$bash gP -f config.gomn dashboard custom\ css colors primary\ text\ color $>;
        --sidebar-bg: <$bash gP -f config.gomn dashboard custom\ css colors sidebar\ bg $>;
        --topbar-bg: <$bash gP -f config.gomn dashboard custom\ css colors topbar\ bg $>;
        --topbar-font: <$bash gP -f config.gomn dashboard custom\ css fonts title $>;
      }
      /* checks if custom css is set,
          if not, just dumps default into DOM
            (saves on request count) */
      <$bash printf "\n"
        useCustomCSS="$(gP -f config.gomn dashboard custom\ css enable)"
        if [[ "$useCustomCSS" == "true" ]]; then
          gP -f config.gomn dashboard custom\ css css
        else
          cat web/style.css
        fi
      $>
    </style>
  </head>
  <body>
    <div class="topbar">
      <!-- set custom tile from config -->
      <span class="searchbarTitle"><$bash gP -f config.gomn dashboard name $></span>
      <!-- set search engine url from config -->
      <form class="searchbar"
         action="//<$bash gP -f config.gomn dashboard search url $>">
        <!-- set search engine query param (also the placeholder text) --> 
        <input type="search" class="bar"
           name="<$bash gP -f config.gomn dashboard search param $>"
           placeholder="Search <$bash gP -f config.gomn dashboard search name $>">
        <input type="submit" name="searchBtn" class="button" value="Go">
        <input type="button" name="placeholder" class="placeholderBtn" value="tbd">
      </form>
    </div>
    <div id="sidebar">
      <!-- create a button for each endpoint --> 
      <$bash
        #get list of endpoints
        endPts="$(ls web/endpoints)"
        #count endpoints
        amnt=$(ls -l web/endpoints | wc -l)

        i=1 #used for checks
        for pt in ${endPts}; do
          #remove file extension from name
          ptName="$(printf ${pt} | sed 's|.elh$||g')"
          
          #construct relative filepath to endpoint ELH
          ptFile="web/endpoints/${pt}"

          #endpoint title from '.ptName' HTML element
          ptTitle="$(grep -oPz 'ptName"(.*>?)>(.*?)</(.*?)>' ${ptFile} | tr -d '\0')"
          ptTitle="$(printf "${ptTitle}\n" | head -n 1 | sed 's|ptName">||')"
          ptTitle="$(printf "${ptTitle}\n" | sed 's|</.*$||')"

          #formatting (so final html looks nice)
          if [ ${i} -ne 1 ]; then printf "      "; fi

          #print element
          printf "<p id=\"itm\" class=\"${ptName}\""
          printf " onclick=\"openEndPt(this, event);\">${ptTitle}</p>"

          ((i++))

          #formatting (so final html looks nice)
          if [ ${i} -lt ${amnt} ]; then 
            printf "\n"
          fi
        done
      $>
    </div>
    <div id="endPtPane">
      <!-- set by client using JS -->
    </div>
    <script>
      // just dumps js into DOM (to save on requests)
      <$bash cat web/script.js $>
    </script>
  </body>
</html>
